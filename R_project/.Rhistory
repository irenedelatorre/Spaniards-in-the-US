rename(
censo_12 = paste0("a 1-dic-", year),
censo_11 = paste0("a 1-nov-", year),
censo_10 = paste0("a 1-oct-", year),
censo_09 = paste0("a 1-sep-", year),
censo_08 = paste0("a 1-ago-", year),
censo_07 = paste0("a 1-jul-", year),
censo_06 = paste0("a 1-jun-", year),
censo_05 = paste0("a 1-may-", year),
censo_04 = paste0("a 1-abr-", year),
censo_03 = paste0("a 1-mar-", year),
censo_02 = paste0("a 1-feb-", year),
censo_01 = paste0("a 1-ene-", year)
);
} else {
df_filtered <- df_filtered %>%
rename(
censo_12 = paste0("a 1-12-", year),
censo_11 = paste0("a 1-11-", year),
censo_10 = paste0("a 1-10-", year),
censo_09 = paste0("a 1-09-", year),
censo_08 = paste0("a 1-08-", year),
censo_07 = paste0("a 1-07-", year),
censo_06 = paste0("a 1-06-", year),
censo_05 = paste0("a 1-05-", year),
censo_04 = paste0("a 1-04-", year),
censo_03 = paste0("a 1-03-", year),
censo_02 = paste0("a 1-02-", year),
censo_01 = paste0("a 1-01-", year)
);
}
df_filtered
}
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
# year_15,
# year_16,
# year_17,
# year_18,
# year_19,
# year_20,
# year_21,
# year_22,
year_23
)
clean_2014 <- function(df, year, month) {
df_filtered <- df %>%
rename(
consulado_id = "...3",
consulado = "...4",
pais_id = "...1",
pais = "...2"
) %>%
filter(pais_id %in% c(302)) %>%
mutate(year = year) %>%
select_if( ~ !all(is.na(.)))
if (month == "month") {
df_filtered <- df_filtered %>%
rename(
censo_12 = paste0("a 1-dic-", year),
censo_11 = paste0("a 1-nov-", year),
censo_10 = paste0("a 1-oct-", year),
censo_09 = paste0("a 1-sep-", year),
censo_08 = paste0("a 1-ago-", year),
censo_07 = paste0("a 1-jul-", year),
censo_06 = paste0("a 1-jun-", year),
censo_05 = paste0("a 1-may-", year),
censo_04 = paste0("a 1-abr-", year),
censo_03 = paste0("a 1-mar-", year),
censo_02 = paste0("a 1-feb-", year),
censo_01 = paste0("a 1-ene-", year)
);
} else {
df_filtered <- df_filtered %>%
rename(
censo_12 = paste0("a 1-12-", year),
censo_11 = paste0("a 1-11-", year),
censo_10 = paste0("a 1-10-", year),
censo_09 = paste0("a 1-09-", year),
censo_08 = paste0("a 1-08-", year),
censo_07 = paste0("a 1-07-", year),
censo_06 = paste0("a 1-06-", year),
censo_05 = paste0("a 1-05-", year),
censo_04 = paste0("a 1-04-", year),
censo_03 = paste0("a 1-03-", year),
censo_02 = paste0("a 1-02-", year),
censo_01 = paste0("a 1-01-", year)
);
}
df_filtered
}
year_14 <- clean_2014(paisconsu_14, 2014, "number")
year_15 <- clean_2014(paisconsu_15, 2015, "month")
year_16 <- clean_2014(paisconsu_16, 2016, "month")
year_17 <- clean_2014(paisconsu_17, 2017, "month")
year_18 <- clean_2014(paisconsu_18, 2018, "month")
year_19 <- clean_2014(paisconsu_19, 2019, "month")
year_20 <- clean_2014(paisconsu_20, 2020, "month")
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
# year_15,
# year_16,
# year_17,
# year_18,
# year_19,
# year_20,
# year_21,
# year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
# year_16,
# year_17,
# year_18,
# year_19,
# year_20,
# year_21,
# year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
# year_17,
# year_18,
# year_19,
# year_20,
# year_21,
# year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
# year_18,
# year_19,
# year_20,
# year_21,
# year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
# year_19,
# year_20,
# year_21,
# year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
# year_20,
# year_21,
# year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
# year_21,
# year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
year_21,
# year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
year_21,
year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
year_21,
year_22,
year_23
) %>%
filter(pais_id != 392)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
year_21,
year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
year_21,
year_22,
year_23
) %>%
filter(pais_id != 392)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
year_21,
year_22,
year_23
)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
year_21,
year_22,
year_23
) %>%
filter((pais_id != 392) %>% replace_na(TRUE))
library(tidyr)
all_years <- rbind(
year_05,
year_06,
year_07,
year_08,
year_09,
year_10,
year_11,
year_12,
year_13,
year_14,
year_15,
year_16,
year_17,
year_18,
year_19,
year_20,
year_21,
year_22,
year_23
) %>%
filter((pais_id != 392) %>% replace_na(TRUE))
summary(all_years)
library(reshape2)
install.packages("reshape2")
library(reshape2)
us_consulates <- melt(
all_years,
id.vars=c("pais_id", "pais", "consulado_id", "consulado", "year")
)
View(us_consulates)
us_consulates <- melt(
all_years,
id.vars=c("pais_id", "pais", "consulado_id", "consulado", "year")
) %>%
rename(censo = value)
test <- "censo_11"
gsub("^.*_", "", test)
library(reshape2)
us_consulates <- melt(
all_years,
id.vars=c("pais_id", "pais", "consulado_id", "consulado", "year")
) %>%
rename(
censo = value,
year = variable) %>%
mutate(
year = gsub("^.*_", "", year)
)
us_consulates <- melt(
all_years,
id.vars=c("pais_id", "pais", "consulado_id", "consulado", "year")
) %>%
rename(
censo = value,
year = variable) %>%
mutate(
year = str_split(year, "^.*_" %>%  map(., as.numeric))
# mutate(x=str_split(x, "\\s") %>%  map(., as.numeric) %>% map_dbl(., sum))
)
us_consulates <- melt(
all_years,
id.vars=c("pais_id", "pais", "consulado_id", "consulado", "year")
) %>%
rename(
censo = value,
mes = variable) %>%
mutate(
mes = str_split(mes, "^.*_" %>%  map(., as.numeric))
# mutate(x=str_split(x, "\\s") %>%  map(., as.numeric) %>% map_dbl(., sum))
)
library(tidyverse)
us_consulates <- melt(
all_years,
id.vars=c("pais_id", "pais", "consulado_id", "consulado", "year")
) %>%
rename(
censo = value,
mes = variable) %>%
mutate(
mes = str_split(mes, "^.*_" %>%  map(., as.numeric))
# mutate(x=str_split(x, "\\s") %>%  map(., as.numeric) %>% map_dbl(., sum))
)
us_consulates <- melt(
all_years,
id.vars=c("pais_id", "pais", "consulado_id", "consulado", "year")
) %>%
rename(
censo = value,
mes = variable) %>%
mutate(
mes = gsub("^.*_", "", mes)
# mutate(x=str_split(x, "\\s") %>%  map(., as.numeric) %>% map_dbl(., sum))
)
us_consulates <- melt(
all_years,
id.vars=c("pais_id", "pais", "consulado_id", "consulado", "year")
) %>%
rename(
censo = value,
month = variable) %>%
mutate(
month = gsub("^.*_", "", month)
# mutate(x=str_split(x, "\\s") %>%  map(., as.numeric) %>% map_dbl(., sum))
)
write.csv(us_consulates, "../data/cera_consulados.csv", row.names=FALSE)
View(us_consulates)
